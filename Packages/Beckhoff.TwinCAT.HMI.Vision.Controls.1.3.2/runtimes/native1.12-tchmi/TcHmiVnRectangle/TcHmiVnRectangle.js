var TcHmi;!function(t){let e;!function(t){let e;!function(t){let e;!function(t){class e extends t.TcHmiVnShape{constructor(s,i,r){super(s,i,r),this.__$props=new e.Properties,this.__$controls=new e.SubControls,this.__uiUpdateAllowed=!1,this.__domRect=null,this.__domEllipse=null,this.__handleElements={p:[],e:[],r:null,c:null},this.__originElement=null,this.__handleData={p:[],e:[],r:{position:t.Vector.fromArray([0,0]),cursor:"none"},c:{position:t.Vector.fromArray([0,0]),cursor:"none"}},this.__origin={isActive:!1,position:new t.Vector(0,0),timestamp:0,isTouching:!1},this.__rectangle=new e.RotatedRectangle(!1,new t.Vector(0,0),new t.Vector(0,0),0),this.__cornerDrag={directions:new Array(2),borderLines:new Array(4),minValues:new Array(8),maxValues:new Array(8),maxAspectRatioFactors:new Array(4),mousePosition:new t.Vector,fixedHandlePosition:new t.Vector,fixedHandlePositionOffset:new t.Vector,borderAllowed:!0,lastRectangleSize:new t.Vector},this.__edgeDrag={fixedIndex:0,minPos:0,maxPos:0,fixedPosition:new t.Vector,lastRectangleSize:new t.Vector},this.__activeDrag=e.ActiveDrag.None,this.__initiating=!1,this.__oldRectangle=null,this.__shapeDragHandlerRegistered=!1,this.counter=[]}__attach(){this.__registerShapeElements(),this.__registerHandleElements(),super.__attach(),this.__registerStaticListeners(),this.__registerHandleEventListeners(),this.__uiUpdateAllowed=!0,this.__updateUI(),this.__processClickableSize()}__registerStaticListeners(){this.__$dom.SVG.bind("mousedown",(t=>{this.__touchCheck()&&this.__handleSurfaceMouseDown(t)})),this.__$dom.SVG.bind("touchstart",(t=>{this.__touchActive(),this.__handleSurfaceMouseDown(t)})),this.__$dom.SVG.bind("touchmove",(t=>{this.__touchActive(),this.__handleMouseMove(t)})),this.__$dom.SVG.bind("touchend",(t=>{this.__touchEnd(),this.__handleMouseUp(t)})),this.__$dom.SVG.bind("touchcancel",(t=>{this.__touchEnd(),this.__handleMouseUp(t)}))}__registerGlobalEvents(){super.__registerGlobalEvents(),this.__$dom.SVG.css("cursor","default"),this.__globalEventsRegistered=!0}__unregisterGlobalEvents(){this.__rotationHandleMouseOver||super.__unregisterGlobalEvents(),this.__$dom.SVG.css("cursor","default")}__registerShapeElements(){this.__domRect=this.__element.find(".TcHmi_Controls_Beckhoff_Vision_TcHmiVnShape-rect"),0===this.__domRect.length&&console.error("element not found (rect)"),this.__domEllipse=this.__element.find(".TcHmi_Controls_Beckhoff_Vision_TcHmiVnShape-ellipse"),0===this.__domEllipse.length&&console.error("element not found (ellipse)"),this.__processStrokeColor()}__registerHandleElements(){super.__registerOutsideHandleElement(this.__element.find(".TcHmi_Controls_Beckhoff_Vision_TcHmiVnShape-o")),this.__originElement=this.__element.find(".TcHmi_Controls_Beckhoff_Vision_TcHmiVnShape-origin"),0===this.__originElement.length&&console.error("element not found (origin)"),this.__handleElements.c=this.__element.find(".TcHmi_Controls_Beckhoff_Vision_TcHmiVnShape-c"),0===this.__handleElements.c.length&&console.error("element not found (c)");for(let t=0;t<4;t++)this.__handleElements.e[t]=this.__element.find(".TcHmi_Controls_Beckhoff_Vision_TcHmiVnShape-e"+t),0===this.__handleElements.e[t].length&&console.error("element not found (e)");for(let t=0;t<4;t++)this.__handleElements.p[t]=this.__element.find(".TcHmi_Controls_Beckhoff_Vision_TcHmiVnShape-p"+t),0===this.__handleElements.p[t].length&&console.error("element not found (p)");this.__handleElements.r=this.__element.find(".TcHmi_Controls_Beckhoff_Vision_TcHmiVnShape-r"),0===this.__handleElements.r.length&&console.error("element not found (r)"),this.__processHandleColor(),this.__processClickableSize(),this.__rotatingCursor=this.__element.find(".TcHmi_Controls_Beckhoff_Vision_TcHmiVnShape-m"),0===this.__rotatingCursor.length&&console.error("element not found (m)"),this.__rotatingCursor?.css("position","absolute"),this.__rotatingCursor?.css("width",20),this.__rotatingCursor?.css("height",20),this.__rotatingCursor?.css("will-change","transform"),this.__rotatingCursor?.css("display","none"),this.__rotatingCursor?.css("transition","transform 0.1 linear"),this.__rotatingCursor?.css("pointer-events","none")}__updateShapeHandleEventListeners(){this.__$props.ShapeDragging?this.__shapeDragHandlerRegistered||(this.__domRect?.on("mousedown",(t=>{this.__touchCheck()&&this.__shapeDragHandler(t)})),this.__domRect?.on("touchstart",(t=>{this.__touchActive(),this.__shapeDragHandler(t)})),this.__domEllipse?.on("mousedown",(t=>{this.__touchCheck()&&this.__shapeDragHandler(t)})),this.__domEllipse?.on("touchstart",(t=>{this.__touchActive(),this.__shapeDragHandler(t)})),this.__shapeDragHandlerRegistered=!0):(this.__domRect?.off("mousedown"),this.__domRect?.off("touchstart"),this.__domEllipse?.off("mousedown"),this.__domEllipse?.off("touchstart"),this.__shapeDragHandlerRegistered=!1)}__registerHandleEventListeners(){super.__registerHandleEventListeners(),this.__handleElements.c?.on("mousedown",(t=>{this.__touchCheck()&&this.__shapeDragHandler(t)})),this.__handleElements.c?.on("touchstart",(t=>{this.__touchActive(),this.__shapeDragHandler(t)})),this.__updateShapeHandleEventListeners();for(let t=0;t<4;t++)this.__handleElements.e[t].on("mousedown",(e=>{this.__touchCheck()&&this.__edgeDragHandler(e,t)})),this.__handleElements.e[t].on("touchstart",(e=>{this.__touchActive(),this.__edgeDragHandler(e,t)}));for(let t=0;t<4;t++)this.__handleElements.p[t].on("mousedown",(e=>{this.__touchCheck()&&this.__cornerDragHandler(e,t)})),this.__handleElements.p[t].on("touchstart",(e=>{this.__touchActive(),this.__cornerDragHandler(e,t)}));this.__handleElements.r?.on("mousedown",(t=>{this.__touchCheck()&&this.__rotationDragHandler(t)})),this.__handleElements.r?.on("touchstart",(t=>{this.__touchActive(),this.__rotationDragHandler(t)})),this.__handleElements.r?.on("mouseenter",(t=>{this.__rotationHandleMouseOver=!0,this.__activeDrag==e.ActiveDrag.None&&(this.__registerGlobalEvents(),this.__rectangle.isActive&&this.__touchCheck()&&(this.__rotatingCursor?.css("display","block"),this.__$dom.SVG.css("cursor","none")))})),this.__handleElements.r?.on("mouseleave",(t=>{this.__rotationHandleMouseOver=!1,this.__activeDrag==e.ActiveDrag.None&&(this.__unregisterGlobalEvents(),this.__stopRotatingCursor())}))}__handleSurfaceMouseDown(s){if(s.target===this.__$dom.SVG[0]&&!this.__rectangle.isActive){const i=this.__positionFromEvent(s);if(!this.__$props.Boundary.isActive||this.__isPointInBoundary(i))if(this.__origin.isActive)this.__registerGlobalEvents(),this.__handleMouseMove(i);else{this.__origin.isActive=!0,this.__origin.position=i,this.__origin.timestamp=t.timestamp(),this.__originElement?.css("display","block");const s=this.__origin.position.plus(this.__offset).times(this.__$props.Scale);this.__originElement?.attr("cx",s.x),this.__originElement?.attr("cy",s.y),this.__originElement?.attr("r",this.__$props.HandleSize),this.__$props.InitialSelection!==e.Schema.InitialSelection.OnlyViaClicks?(this.__registerGlobalEvents(),this.__originElement?.css("cursor","default")):this.__originElement?.css("cursor","cross-hair"),this.__initiating=!0}s.stopPropagation()}}__shapeDragHandler(s,i=!1){this.__activeDrag=e.ActiveDrag.Shape,this.__oldRectangle=this.__rectangle.copy(),this.__updateUI(),this.__shapeDrag.referencePosition=i?new t.Vector(0,0):this.__positionFromEvent(s).minus(this.__rectangle.center),this.__shapeDrag.lastPosition=this.__rectangle.center.copy(),this.__updateShapeDragBorders(this.__handleData.p.map((t=>t.position)),this.__rectangle.center),this.__registerGlobalEvents(),this.__$dom.SVG.css("cursor","move"),s.stopPropagation()}__edgeDragHandler(t,s){this.__$props.AspectRatio||(this.__activeDrag=e.ActiveDrag.Edge,this.__oldRectangle=this.__rectangle.copy(),this.__edgeDrag.fixedIndex=(s+2)%4,this.__$props.Boundary.isActive&&this.__rectangle.isActive&&!this.__$props.ShapeIsInBoundary&&this.__moveShapeInside(),this.__updateUI(),this.__edgeDrag.fixedPosition=this.__handleData.e[this.__edgeDrag.fixedIndex].position,this.__initEdgeDrag(s),this.__registerGlobalEvents(),this.__$dom.SVG.css("cursor",this.__handleData.e[s].cursor),t.stopPropagation(),this.counter.push(0))}__cornerDragHandler(t,s){this.__activeDrag=e.ActiveDrag.Corner,this.__oldRectangle=this.__rectangle.copy(),this.__$props.Boundary.isActive&&this.__rectangle.isActive&&!this.__$props.ShapeIsInBoundary&&this.__moveShapeInside(),this.__updateUI(),this.__cornerDrag.fixedHandlePosition=this.__handleData.p[(s+2)%4].position,this.__cornerDrag.mousePosition=this.__positionFromEvent(t),this.__initCornerDrag(),this.__registerGlobalEvents(),this.__$dom.SVG.css("cursor",this.__handleData.p[s].cursor),t.stopPropagation()}__rotationDragHandler(t){this.__activeDrag=e.ActiveDrag.Rotation,this.__oldRectangle=this.__rectangle.copy(),this.__$props.Boundary.isActive&&!this.__$props.ShapeIsInBoundary&&this.__moveShapeInside(),this.__updateUI(),this.__updateAngleRestrictions(this.__handleData.p.map((t=>t.position)),this.__rectangle.center,this.__rectangle.angle),this.__rotationDrag.referenceAngle=this.__rectangle.angle,this.__rotationDrag.lastAngle=this.__rectangle.angle,this.__registerGlobalEvents(),t.stopPropagation()}__trimPoint(e){if(this.__$props.Boundary.isActive){const s=this.__shapeBoundary.position.x,i=this.__shapeBoundary.position.x+this.__shapeBoundary.size.x,r=this.__shapeBoundary.position.y,a=this.__shapeBoundary.position.y+this.__shapeBoundary.size.y;return new t.Vector(Math.min(Math.max(e.x,s),i),Math.min(Math.max(e.y,r),a))}return e}__isRotated(){const t=this.__rectangle.angle/(Math.PI/2),e=Math.round(1e3*t)/1e3;return 0!=e&&1!=e&&2!=e&&3!=e}__initEdgeDrag(e){if(this.__$props.Boundary.isActive){const s=t.Vector.fromAngle(this.__rectangle.angle+(0==e||2==e?Math.PI/2:0));let i=e;const r=[{start:this.__handleData.p[++i%4].position,direction:s},{start:this.__handleData.p[++i%4].position,direction:s}];let a=[[],[]],_=-1;this.__isRotated()||(_=Math.round(1e3*(e+this.__rectangle.angle/(Math.PI/2)))/1e3%4),r.forEach(((e,s)=>{this.__boundaryLines.forEach(((i,r)=>{if(!((0!=_&&2!=_||1!=r&&3!=r)&&(1!=_&&3!=_||0!=r&&2!=r)))return;let n=t.Vector.intersection(e,i);if(isFinite(n)&&this.__$props.Boundary.isActive){const i=t.Vector.pointFromLine(e,n);a[s].push({factor:n,intersection:i})}}))})),this.__edgeDrag.maxPos=1/0,this.__edgeDrag.minPos=-1/0,a=a.map((t=>t.sort(((t,e)=>t.factor<e.factor?-1:t.factor>e.factor?1:0)))),a.forEach(((t,e)=>{if(t.length>=2){const e=2==t.length?1:2,s=2==t.length?0:1;let i=t[e],r=this.__trimPoint(i.intersection);i.intersection.differsTo(r),this.__edgeDrag.maxPos=Math.min(i.factor,this.__edgeDrag.maxPos),i=t[s],r=this.__trimPoint(i.intersection),i.intersection.differsTo(r),this.__edgeDrag.minPos=Math.max(i.factor,this.__edgeDrag.minPos)}}))}}__initCornerDrag(){if(this.__cornerDrag.directions=[t.Vector.fromAngle(this.__rectangle.angle),t.Vector.fromAngle(this.__rectangle.angle+Math.PI/2)],this.__cornerDrag.borderAllowed=!0,this.__$props.Boundary.isActive||this.__$props.AspectRatio){const e=[{start:this.__cornerDrag.fixedHandlePosition,direction:this.__cornerDrag.directions[0]},{start:this.__cornerDrag.fixedHandlePosition,direction:this.__cornerDrag.directions[1]}],s=(e,s)=>{const i=new Array(e.length);return e.forEach(((e,r)=>{i[r]=[],s.forEach((s=>{const a=t.Vector.intersection(e,s);isFinite(a)&&i[r].push(a)}))})),i},i=new Array(4);let r=s(e,this.__boundaryLines);if(r.forEach(((s,a)=>{s.sort(((t,e)=>t<e?-1:t>e?1:0)),i[a+1]=s[2==r[a].length?0:1],i[-3*a+3]=s[2==r[a].length?1:2],!this.__$props.AspectRatio&&this.__isRotated()&&(this.__cornerDrag.borderLines[2*a]={start:this.__trimPoint(t.Vector.pointFromLine(e[a],i[a+1])),direction:this.__cornerDrag.directions[1==a?0:1]},this.__cornerDrag.borderLines[2*a+1]={start:this.__trimPoint(t.Vector.pointFromLine(e[a],i[-3*a+3])),direction:this.__cornerDrag.directions[1==a?0:1]})})),this.__$props.AspectRatio){const e=[{start:this.__cornerDrag.fixedHandlePosition,direction:t.Vector.fromAngle(new t.Vector(this.__$props.AspectRatio,1).getAngle()+this.__rectangle.angle+Math.PI/2)},{start:this.__cornerDrag.fixedHandlePosition,direction:t.Vector.fromAngle(new t.Vector(this.__$props.AspectRatio,-1).getAngle()+this.__rectangle.angle+Math.PI/2)}];r=s(e,this.__boundaryLines);const a=new Array(4);r.forEach(((t,e)=>{t.sort(((t,e)=>t<e?-1:t>e?1:0)),a[0==e?2:1]=t[2==r[e].length?0:1],a[0==e?0:3]=t[2==r[e].length?1:2]}));const _=new t.Vector(this.__$props.AspectRatio,1).getAngle()-1.5*Math.PI,n=Math.sin(_),o=Math.cos(_);a.forEach(((t,e)=>{const s=i[e<2?0:2]/n,r=i[1==e||2==e?1:3]/o,a=Math.abs(s)<Math.abs(r)?s:r;this.__cornerDrag.maxAspectRatioFactors[e]=Math.abs(t)<Math.abs(a)?t:a}))}else{r=s(this.__cornerDrag.borderLines,this.__boundaryLines.concat(this.__cornerDrag.borderLines));const e=s(this.__boundaryLines,this.__cornerDrag.borderLines),i=s(this.__boundaryLines,this.__boundaryLines),a=(t,e,s,i=0)=>{t.sort(((t,e)=>t<e?-1:t>e?1:0)),this.__cornerDrag.minValues[e+i]=t[2==s?0:4==s?1:2],this.__cornerDrag.maxValues[e+i]=t[2==s?1:4==s?2:3]};this.__isRotated()?(r.forEach(((t,e)=>a(t,e,r[e].length))),e.forEach(((t,s)=>a(t,s,e[s].length,4)))):i.forEach(((t,e)=>a(t,e,i[e].length)));const _=this.__cornerDrag.mousePosition.minus(this.__cornerDrag.fixedHandlePosition);this.__cornerDrag.fixedHandlePositionOffset=t.Vector.pointFromLine({start:this.__cornerDrag.fixedHandlePosition.round(),direction:_},1/_.l2())}}else this.__cornerDrag.borderLines=new Array(4);this.__cornerDrag.lastRectangleSize=this.__rectangle.size.copy()}__updateShapeDragBorders(t,e){super.__updateShapeDragBorders(t,e,this.__isRotated())}__handleMouseMove(s){let i=s instanceof t.Vector?s:this.__positionFromEvent(s),r=s instanceof t.Vector?()=>{}:()=>s.stopPropagation();const a=this.__rectangle.copy();if(this.__origin.isActive){const s=t.timestamp()-this.__origin.timestamp,a=i.minus(this.__origin.position).l1();(s>100&&a>5||a>20)&&(this.__rectangle.isActive=!0,this.__origin.isActive=!1,this.__originElement?.css("display","none"),this.__activeDrag=e.ActiveDrag.Corner,this.__cornerDrag.fixedHandlePosition=this.__origin.position.copy(),this.__initCornerDrag(),r())}switch(this.__activeDrag){case e.ActiveDrag.Shape:{const e=i.minus(this.__shapeDrag.referencePosition);let s=new t.Vector(0,0);this.__$props.Boundary.isActive?(s.x=Math.min(Math.max(e.x,this.__shapeDrag.borders[1]),this.__shapeDrag.borders[3]),s.y=Math.min(Math.max(e.y,this.__shapeDrag.borders[2]),this.__shapeDrag.borders[0])):s=e,this.__rectangle.center=s,this.__updateShapeData(a,this.__$props.DataUpdate==t.DataUpdate.onChanged),this.__shapeDrag.lastPosition=s.copy(),this.__updateUI();break}case e.ActiveDrag.Edge:if(!this.__$props.AspectRatio){this.counter[this.counter.length-1]++>5&&console.log();const e=0===this.__edgeDrag.fixedIndex||2===this.__edgeDrag.fixedIndex,s={start:this.__edgeDrag.fixedPosition,direction:t.Vector.fromAngle(this.__rectangle.angle+(e?Math.PI/2:0))};let r,_=t.Vector.perpendicularDrop({start:this.__edgeDrag.fixedPosition,direction:t.Vector.fromAngle(this.__rectangle.angle+(e?Math.PI/2:0))},i);r=this.__$props.Boundary.isActive?Math.min(Math.max(_,this.__edgeDrag.minPos),this.__edgeDrag.maxPos):_;const n=t.Vector.pointFromLine(s,r);this.__rectangle.center=t.Vector.pointFromLine(s,r/2);const o=n.minus(s.start).l2();e?(this.__rectangle.size.y=o,this.__rectangle.size.x=this.__rectangle.size.x):(this.__rectangle.size.x=o,this.__rectangle.size.y=this.__rectangle.size.y),this.__updateShapeData(a,this.__$props.DataUpdate==t.DataUpdate.onChanged),this.__updateUI();break}case e.ActiveDrag.Corner:{let e;if(this.__$props.AspectRatio){let s=i.minus(this.__cornerDrag.fixedHandlePosition);s=s.rotate2d(-this.__rectangle.angle);const r=Math.sign(s.x),a=Math.sign(s.y),_={start:this.__cornerDrag.fixedHandlePosition,direction:t.Vector.fromAngle(new t.Vector((0==r?-1:r)*this.__$props.AspectRatio,0==a?-1:a).getAngle()+this.__rectangle.angle+Math.PI/2)},n=t.Vector.intersection(_,{start:i,direction:this.__cornerDrag.directions[0]}),o=t.Vector.intersection(_,{start:i,direction:this.__cornerDrag.directions[1]}),h=Math.abs(n)>Math.abs(o)?n:o;if(this.__cornerDrag.borderAllowed&&this.__$props.Boundary.isActive){const s=this.__cornerDrag.maxAspectRatioFactors[1==r&&1==a?0:1==r&&-1==a?3:-1==r&&1==a?1:2];e=t.Vector.pointFromLine(_,Math.min(Math.abs(s),h)),Math.abs(s)<h&&(i=t.Vector.pointFromLine(_,h))}else e=t.Vector.pointFromLine(_,h)}else if(this.__cornerDrag.borderAllowed&&this.__$props.Boundary.isActive){const s={start:this.__cornerDrag.fixedHandlePositionOffset,direction:i.minus(this.__cornerDrag.fixedHandlePositionOffset)};let r,a=1,_=-1;const n=(e,i)=>{const n=t.Vector.intersection(s,e);isFinite(n)&&n<a&&n>=0&&(a=n,r=e,_=i)};if(this.__isRotated()?(this.__cornerDrag.borderLines.forEach(((t,e)=>n(t,e))),this.__boundaryLines.forEach(((t,e)=>n(t,e+4)))):this.__boundaryLines.forEach(((t,e)=>n(t,e))),a<1){let s=t.Vector.perpendicularDrop(r,i);if(s=Math.min(this.__cornerDrag.maxValues[_],Math.max(this.__cornerDrag.minValues[_],s)),e=this.__trimPoint(t.Vector.pointFromLine(r,s)),this.__isRotated()){const s=this.__rectangle.center.minus(e);e=t.Vector.pointFromLine({start:e,direction:s},1/s.l2())}}else e=i}else e=i;const s={start:this.__cornerDrag.fixedHandlePosition,direction:this.__cornerDrag.directions[0]},r=t.Vector.pointFromLine(s,t.Vector.intersection(s,{start:e,direction:this.__cornerDrag.directions[1]}));this.__rectangle.size.x=this.__cornerDrag.fixedHandlePosition.minus(r).l2(),this.__rectangle.size.y=e.minus(r).l2();let _=e.minus(this.__cornerDrag.fixedHandlePosition);this.__rectangle.center=this.__cornerDrag.fixedHandlePosition.plus(_.times(.5)),this.__updateShapeData(a,this.__$props.DataUpdate==t.DataUpdate.onChanged),this.__cornerDrag.lastRectangleSize=this.__rectangle.size.copy(),this.__updateUI(),this.__initiating=!1;break}}if(this.__activeDrag==e.ActiveDrag.Rotation||this.__rotationHandleMouseOver){let s=i.minus(this.__rectangle.center).getAngle();if(this.__lastMouseAngle=s,this.__activeDrag==e.ActiveDrag.Rotation){let e=s;this.__$props.AngleInterval>0?e=this.__forceAngleInterval(s):this.__$props.Boundary.isActive&&(e=this.__forceAngleIntoRestrictions(s)),this.__rectangle.angle=Math.round(1e7*this.__fitAngle(e))/1e7,this.__updateShapeData(a,this.__$props.DataUpdate==t.DataUpdate.onChanged),this.__rotationDrag.lastAngle=e,this.__updateUI()}this.__updateRotatingCursor()}this.__activeDrag!=e.ActiveDrag.None&&r()}__handleMouseLeave(t){this.__handleMouseUp(t)}__handleMouseUp(s){if(this.__$props.InitialSelection==e.Schema.InitialSelection.OnlyViaDrag&&(this.__origin.isActive=!1,this.__originElement?.css("display","none")),this.__$props.AspectRatio){const t=this.__rectangle.copy(),e=this.__rectangle.size,s=Math.abs(e[0]/e[1]);s>this.__$props.AspectRatio?e[0]=Math.abs(e[1]*this.__$props.AspectRatio)*Math.sign(e[0]):s<this.__$props.AspectRatio&&(e[1]=Math.abs(e[0]/this.__$props.AspectRatio)*Math.sign(e[1])),s!=this.__$props.AspectRatio&&this.__updateShapeData(t)}this.__stopRotatingCursor(),!this.__$props.Boundary.isActive||this.__activeDrag!=e.ActiveDrag.Corner&&this.__activeDrag!=e.ActiveDrag.Edge&&this.__activeDrag!=e.ActiveDrag.Rotation||this.__moveShapeInside(),e.rectangleDataIsValid(this.__convertRectangle(this.__rectangle))||this.__clearRectangle(),this.__$props.DataUpdate==t.DataUpdate.onConfirmed&&this.__updateShapeData(this.__oldRectangle);const i=this.__activeDrag==e.ActiveDrag.None;this.__activeDrag=e.ActiveDrag.None,this.__unregisterGlobalEvents(),this.__updateUI(),this.__rectangle.isActive&&!i&&this.__shapeConfirmed(),s.stopPropagation()}__updateUI(){this.__uiUpdateAllowed&&(this.__updateShapeUI(),this.__updateHandleUI())}__updateShapeUI(){if(this.__isAttached)if(this.__rectangle.isActive){if(this.__activeDrag==e.ActiveDrag.Rotation||this.__rotationHandleMouseOver)this.__$dom.SVG.css("cursor","none");else switch(this.__activeDrag){case e.ActiveDrag.None:this.__$dom.SVG.css("cursor","default");break;case e.ActiveDrag.Shape:this.__$dom.SVG.css("cursor","move");break;default:this.__$dom.SVG.css("cursor","crosshair")}let t;if(this.__$props.ShapeDragging)switch(this.__activeDrag){case e.ActiveDrag.None:case e.ActiveDrag.Shape:t="move";break;case e.ActiveDrag.Rotation:t="none";break;default:t="crosshair"}else t="default";const s={center:this.__rectangle.center.plus(this.__offset).times(this.__$props.Scale),size:this.__rectangle.size.times(this.__$props.Scale),angle:this.__rectangle.angle},i=this.__activeDrag!=e.ActiveDrag.None?1:this.__$props.StrokeThickness.toString();this.__$props.StrokeShape===e.Schema.StrokeShape.Rectangle?(this.__domEllipse?.css("display","none"),this.__domRect?.css("display","block"),this.__domRect?.attr("width",s.size.x),this.__domRect?.attr("height",s.size.y),this.__domRect?.attr("x",s.center.x-s.size.x/2),this.__domRect?.attr("y",s.center.y-s.size.y/2),this.__domRect?.css({stroke:this.__$props.StrokeColor.color,"stroke-width":i,transform:`rotate(${s.angle}rad)`,"stroke-dasharray":"",cursor:t})):this.__$props.StrokeShape===e.Schema.StrokeShape.Ellipse&&(this.__domRect?.css("display","block"),this.__domRect?.attr("width",s.size.x),this.__domRect?.attr("height",s.size.y),this.__domRect?.attr("x",s.center.x-s.size.x/2),this.__domRect?.attr("y",s.center.y-s.size.y/2),this.__domRect?.css({stroke:this.__activeDrag!=e.ActiveDrag.None?this.__transparentColor(this.__$props.StrokeColor.color,.2):this.__$props.StrokeColor.color,"stroke-width":1,transform:`rotate(${s.angle}rad)`,"stroke-dasharray":"8,8",cursor:t}),this.__domEllipse?.css("display","block"),this.__domEllipse?.attr("rx",s.size.x/2),this.__domEllipse?.attr("ry",s.size.y/2),this.__domEllipse?.attr("cx",s.center.x),this.__domEllipse?.attr("cy",s.center.y),this.__domEllipse?.css({stroke:this.__$props.StrokeColor.color,"stroke-width":i,transform:`rotate(${s.angle}rad)`,cursor:t})),this.__updateShapeHandleEventListeners()}else this.__domRect?.css("display","none"),this.__domEllipse?.css("display","none"),this.__$dom.SVG?.css("cursor","crosshair")}__updateHandleUI(){if(!this.__isAttached)return;if(this.__origin.isActive){const t=this.__origin.position.plus(this.__offset).times(this.__$props.Scale);this.__originElement?.attr("cx",t.x),this.__originElement?.attr("cy",t.y)}this.__updateRotatingCursor();const t=this.__activeDrag!=e.ActiveDrag.None?this.__transparentColor(this.__$props.HandleColor.color,.2):this.__$props.HandleColor.color,s={c:this.__handleData.c.position.plus(this.__offset).times(this.__$props.Scale),r:this.__handleData.r.position.plus(this.__offset).times(this.__$props.Scale),p:this.__handleData.p.map((t=>t.position.plus(this.__offset).times(this.__$props.Scale))),e:this.__handleData.e.map((t=>t.position.plus(this.__offset).times(this.__$props.Scale)))};if(this.__$props.CenterHandle&&this.__rectangle.isActive?(this.__handleElements.c.css("display","block"),this.__handleElements.c.attr("fill",t),this.__handleElements.c.attr("cx",s.c.x||0),this.__handleElements.c.attr("cy",s.c.y||0),this.__handleElements.c.attr("r",this.__$props.HandleSize),this.__activeDrag!=e.ActiveDrag.Rotation?this.__handleElements.c.attr("cursor","move"):this.__handleElements.c.attr("cursor","none")):this.__handleElements.c.css("display","none"),this.__$props.EdgeHandles&&this.__rectangle.isActive&&!this.__$props.AspectRatio?this.__handleElements.e.forEach(((i,r)=>{switch(i.css("display","block"),i.attr("fill",t),i.attr("cx",s.e[r].x||0),i.attr("cy",s.e[r].y||0),i.attr("r",this.__$props.HandleSize),this.__activeDrag){case e.ActiveDrag.Shape:i.attr("cursor","move");break;case e.ActiveDrag.Rotation:i.attr("cursor","none");break;case e.ActiveDrag.None:i.attr("cursor",this.__handleData.e[r].cursor);break;default:i.attr("cursor","crosshair")}})):this.__handleElements.e.forEach(((t,e)=>{t.css("display","none")})),this.__$props.CornerHandles&&this.__rectangle.isActive?this.__handleElements.p.forEach(((i,r)=>{switch(i.css("display","block"),i.attr("fill",t),i.attr("cx",s.p[r].x||0),i.attr("cy",s.p[r].y||0),i.attr("r",this.__$props.HandleSize),this.__activeDrag){case e.ActiveDrag.Shape:i.attr("cursor","move");break;case e.ActiveDrag.Rotation:i.attr("cursor","none");break;case e.ActiveDrag.None:i.attr("cursor",this.__handleData.p[r].cursor);break;default:i.attr("cursor","crosshair")}})):this.__handleElements.p.forEach(((t,e)=>{t.css("display","none")})),this.__$props.RotationHandle&&this.__rectangle.isActive)switch(this.__handleElements.r.css("display","block"),this.__handleElements.r.attr("fill",t),this.__handleElements.r.attr("cx",s.r.x||0),this.__handleElements.r.attr("cy",s.r.y||0),this.__handleElements.r.attr("r",this.__$props.HandleSize),this.__activeDrag){case e.ActiveDrag.Shape:this.__handleElements.r.attr("cursor","move");break;case e.ActiveDrag.None:case e.ActiveDrag.Rotation:this.__handleElements.r.attr("cursor","none");break;default:this.__handleElements.r.attr("cursor","crosshair")}else this.__handleElements.r.css("display","none");this.__updateOutsideHandleUI(this.__rectangle.isActive)}__stopRotatingCursor(){this.__rectangle.isActive&&!this.__rotationHandleMouseOver&&(this.__rotatingCursor?.css("display","none"),this.__$dom.SVG.css("cursor","default"))}__moveShapeInside(){this.__updateShapeDragBorders(this.__handleData.p.map((t=>t.position)),this.__rectangle.center);const e=this.__rectangle.copy();this.__rectangle.center.x=Math.max(Math.min(this.__rectangle.center.x,this.__shapeDrag.borders[3]),this.__shapeDrag.borders[1]),this.__rectangle.center.y=Math.max(Math.min(this.__rectangle.center.y,this.__shapeDrag.borders[0]),this.__shapeDrag.borders[2]),this.__updateShapeData(e,this.__$props.DataUpdate==t.DataUpdate.onChanged)}__updateShapeData(t=null,e=!0){let s;if(this.__rectangle.isActive){let t=this.__rectangle.angle/Math.PI*180;t=Math.round(1e3*t)/1e3,this.__rectangle.center=this.__rectangle.center.roundTo(3),this.__rectangle.size=this.__rectangle.size.roundTo(3),360==t&&(t=0),s={aCenter:[this.__rectangle.center.x,this.__rectangle.center.y],fAngle:t,stSize:{fWidth:this.__rectangle.size.x,fHeight:this.__rectangle.size.y}}}else s={aCenter:[0,0],fAngle:0,stSize:{fWidth:0,fHeight:0}};if(this.__updateHandleData(),e){this.__setShapeDataInternal(s),(null==t||this.__rectangle.size.differsTo(t.size)||this.__rectangle.center.differsTo(t.center)||this.__rectangle.angle!=this.__rectangle.angle)&&this.__rectangle.isActive&&this.__shapeChanged()}}__getCornerPositions(e){const s=Math.atan2(e.size.y,e.size.x),i=e.size.l2();return[new t.Vector(-i/2,0).rotate2d(e.angle-s).plus(e.center).round(3),new t.Vector(-i/2,0).rotate2d(e.angle+s).plus(e.center).round(3),new t.Vector(i/2,0).rotate2d(e.angle-s).plus(e.center).round(3),new t.Vector(i/2,0).rotate2d(e.angle+s).plus(e.center).round(3)]}__getEdgePositions(e){return[new t.Vector(0,e.size.y/2).rotate2d(e.angle).plus(e.center),new t.Vector(-e.size.x/2,0).rotate2d(e.angle).plus(e.center),new t.Vector(0,-e.size.y/2).rotate2d(e.angle).plus(e.center),new t.Vector(e.size.x/2,0).rotate2d(e.angle).plus(e.center)]}__updateHandleData(){const e=()=>({position:t.Vector.fromArray([0,0]),cursor:"none"});this.__handleData.e.length<4&&(this.__handleData.e=[e(),e(),e(),e()]),this.__handleData.p.length<4&&(this.__handleData.p=[e(),e(),e(),e()]),this.__handleData.c.position=this.__rectangle.center.copy();const s=this.__getEdgePositions(this.__rectangle);this.__handleData.e[0].position=s[0],this.__handleData.e[1].position=s[1],this.__handleData.e[2].position=s[2],this.__handleData.e[3].position=s[3];const i=this.__getCornerPositions(this.__rectangle);this.__handleData.p[0].position=i[0],this.__handleData.p[1].position=i[1],this.__handleData.p[2].position=i[2],this.__handleData.p[3].position=i[3],this.__updateRotationHandleData(),this.__handleData.c.cursor="move";const r=(t,e)=>{switch((Math.floor((180*e/Math.PI+22.5)/45)+t)%4){case 0:return"ns-resize";case 1:return"nesw-resize";case 2:return"ew-resize";default:return"nwse-resize"}};this.__handleData.e.forEach(((t,e)=>t.cursor=r(2*e,this.__rectangle.angle))),this.__handleData.p.forEach(((t,e)=>t.cursor=r(2*e+1,this.__rectangle.angle))),this.__updateOutsideHandleData()}__updateRotationHandleData(){this.__handleData.r.position=new t.Vector(0,this.__rectangle.size.y/2+(2*this.__$props.HandleSize+this.__$props.ClickableSize)*(1/this.__$props.Scale)).rotate2d(this.__rectangle.angle).plus(this.__rectangle.center)}__updateOutsideHandleData(){let t=!1;this.__handleData.p.forEach((e=>t=t||this.__isPointInControlArea(e.position))),this.__handleData.e.forEach((e=>t=t||this.__isPointInControlArea(e.position))),t=t||this.__isPointInControlArea(this.__handleData.c.position)||this.__isPointInControlArea(this.__handleData.r.position),t||this.__$props.Boundary.isActive?this.__resetOutsideHandle():this.__setOutsideHandle(this.__handleData.c.position)}__updateShapeIsInBoundary(){let t=this.__rectangle.isActive;this.__handleData.p.forEach((e=>t=t&&this.__isPointInBoundary(e.position))),this.__setShapeIsInBoundaryInternal(t)}__clearRectangle(){const s=this.__rectangle.isActive;this.__rectangle=new e.RotatedRectangle(!1,new t.Vector(0,0),new t.Vector(0,0),0),this.__updateShapeIsInBoundary(),this.__updateShapeData(),this.__updateUI(),s&&this.__shapeChanged()}__convertRectangle(t){return{fAngle:t.angle,aCenter:[t.center.x,t.center.y],stSize:{fWidth:t.size.x,fHeight:t.size.y}}}shapeDataIsValid(t=null){return e.rectangleDataIsValid(t??this.__$props.ShapeData)}static rectangleDataIsValid(t){return null!=t&&(null!=t.fAngle&&(!!Array.isArray(t.aCenter)&&(null!=t.stSize&&(null!=t.stSize.fWidth&&(null!=t.stSize.fHeight&&(0!==t.stSize.fWidth||0!==t.stSize.fHeight))))))}static roundShapeData(t){const e=(t.fAngle||0)%360,s=e<0?e+360:e;return{aCenter:[Math.round(1e3*t.aCenter[0])/1e3,Math.round(1e3*t.aCenter[1])/1e3],fAngle:Math.round(1e3*s)/1e3,stSize:{fWidth:Math.round(1e3*t.stSize.fWidth)/1e3,fHeight:Math.round(1e3*t.stSize.fHeight)/1e3}}}__processHandleColor(){if(!this.__isAttached)return;const t=this.__$props.HandleColor.color;this.__originElement.attr("fill",t),this.__handleElements.c.attr("fill",t),this.__handleElements.e.forEach((e=>e.attr("fill",t))),this.__handleElements.p.forEach((e=>e.attr("fill",t))),this.__handleElements.r.attr("fill",t)}__processStrokeColor(){if(!this.__isAttached)return;const t=this.__$props.StrokeColor.color;this.__domRect?.css("stroke",t),this.__domEllipse?.css("stroke",t)}__processWidthAndHeightChange(){this.__isAttached&&(this.__updateOutsideHandleData(),this.__updateOutsideHandleUI(this.__rectangle.isActive))}getShapeData(){return this.__$props.ShapeData}setShapeData(t){const e=(t?.fAngle||0)%360,s=e<0?e+360:e;this.__$setProperty("ShapeData",{aCenter:[Math.round(1e3*t.aCenter[0])/1e3,Math.round(1e3*t.aCenter[1])/1e3],fAngle:Math.round(1e3*s)/1e3,stSize:{fWidth:Math.round(1e3*t.stSize.fWidth)/1e3,fHeight:Math.round(1e3*t.stSize.fHeight)/1e3}})}__setShapeDataInternal(t){this.__$setPropertyInternal("ShapeData",t)}__processShapeData(s,i,r){this.shapeDataIsValid()||this.__activeDrag!=e.ActiveDrag.None?(r||(this.__rectangle.isActive=!0,this.__rectangle.angle=s.fAngle*Math.PI/180,this.__rectangle.center=new t.Vector(s.aCenter[0],s.aCenter[1]),this.__rectangle.size=new t.Vector(s.stSize.fWidth,s.stSize.fHeight),this.__updateHandleData()),this.__updateBoundary(),this.__updateUI(),!r&&this.__rectangle.isActive&&(this.__shapeChanged(),this.__shapeConfirmed())):r||this.__clearRectangle()}getAspectRatio(){return this.__$props.AspectRatio}setAspectRatio(t){this.__$setProperty("AspectRatio",t)}__processAspectRatio(){this.__updateHandleUI()}clear(){this.__clearRectangle()}getInitialSelection(){return this.__$props.InitialSelection}setInitialSelection(t){this.__$setProperty("InitialSelection",t)}getCornerHandles(){return this.__$props.CornerHandles}setCornerHandles(t){this.__$setProperty("CornerHandles",t)}__processCornerHandles(){this.__isAttached&&this.__updateUI()}getEdgeHandles(){return this.__$props.EdgeHandles}setEdgeHandles(t){this.__$setProperty("EdgeHandles",t)}__processEdgeHandles(){this.__isAttached&&this.__updateUI()}getCenterHandle(){return this.__$props.CenterHandle}setCenterHandle(t){this.__$setProperty("CenterHandle",t)}__processCenterHandle(){this.__isAttached&&this.__updateUI()}__processRotationHandle(){this.__isAttached&&this.__updateUI()}getShapeDragging(){return this.__$props.ShapeDragging}setShapeDragging(t){this.__$setProperty("ShapeDragging",t)}__processShapeDragging(t){this.__isAttached&&this.__updateUI()}getAngleInterval(){return this.__$props.AngleInterval}setAngleInterval(t){this.__$setProperty("AngleInterval",t)}getStrokeShape(){return this.__$props.StrokeShape}setStrokeShape(t){this.__$setProperty("StrokeShape",t)}__processStrokeShape(t){this.__isAttached&&this.__updateUI()}__processClickableSize(){if(!this.__isAttached)return;const t=this.__$props.ClickableSize;this.__originElement?.attr("stroke-width",t),this.__handleElements.c?.attr("stroke-width",t);for(let e=0;e<4;e++)this.__handleElements.e[e]?.attr("stroke-width",t),this.__handleElements.p[e]?.attr("stroke-width",t);this.__handleElements.r?.attr("stroke-width",t)}__processStrokeThickness(){this.__isAttached&&this.__updateUI()}__processHandleSize(){this.__isAttached&&this.__updateUI()}__processOffsetAndScaleChange(){this.__isAttached&&(this.__updateOutsideHandleData(),this.__updateRotationHandleData(),this.__updateUI())}}t.TcHmiVnRectangle=e,function(e){class s extends t.TcHmiVnShape.Properties{constructor(){super(...arguments),this.ShapeData={aCenter:[0,0],fAngle:0,stSize:{fWidth:0,fHeight:0}},this.AspectRatio=0,this.InitialSelection=r.InitialSelection.ViaBoth,this.CornerHandles=!0,this.EdgeHandles=!0,this.CenterHandle=!0,this.ShapeDragging=!0,this.StrokeShape=r.StrokeShape.Rectangle}}e.Properties=s;class i extends t.TcHmiVnShape.SubControls{}let r,a;e.SubControls=i,function(t){let e,s,i;!function(t){t.Rectangle="Rectangle",t.Ellipse="Ellipse"}(e=t.StrokeShape||(t.StrokeShape={})),function(t){t.OnlyViaClicks="OnlyViaClicks",t.OnlyViaDrag="OnlyViaDrag",t.ViaBoth="ViaBoth"}(s=t.InitialSelection||(t.InitialSelection={})),function(t){t.Normal="Normal",t.Transparent="Transparent"}(i=t.DragView||(t.DragView={}))}(r=e.Schema||(e.Schema={}));class _{constructor(t,e,s,i){this.isActive=t,this.center=e,this.size=s,this.angle=i}copy(){return new _(this.isActive,this.center.copy(),this.size.copy(),this.angle)}}e.RotatedRectangle=_,function(t){t[t.None=0]="None",t[t.Edge=1]="Edge",t[t.Corner=2]="Corner",t[t.Shape=3]="Shape",t[t.Rotation=4]="Rotation"}(a=e.ActiveDrag||(e.ActiveDrag={}))}(e=t.TcHmiVnRectangle||(t.TcHmiVnRectangle={}))}(e=t.Vision||(t.Vision={}))}(e=t.Beckhoff||(t.Beckhoff={})),t.registerEx("TcHmiVnRectangle","TcHmi.Controls.Beckhoff.Vision",e.Vision.TcHmiVnRectangle)}(e=t.Controls||(t.Controls={}))}(TcHmi||(TcHmi={}));