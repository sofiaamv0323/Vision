var TcHmi;!function(t){let e;!function(t){let e;!function(t){let e;!function(t){class e extends t.TcHmiVnControl{constructor(s,i,n){super(s,i,n),this.__$props=new e.Properties,this.__$controls=new e.SubControls,this.__rotatingCursor=null,this.__outsideHandleElement=null,this.__outsideHandle={position:t.Vector.fromArray([0,0]),cursor:"none",angle:0},this.__offset=new t.Vector(0,0),this.__shapeBoundary={position:new t.Vector(0,0),size:new t.Vector(0,0)},this.__rotationHandleMouseOver=!1,this.__shapeDrag={referencePosition:new t.Vector,lastPosition:new t.Vector,borders:new Array(4)},this.__rotationDrag={referenceAngle:0,runningAngle:0,lastMouseAngle:0,lastAngle:0},this.__rotationHandleDisplayPosition=new t.Vector(0,0),this.__lastMouseAngle=0,this.__isTouching=!1,this.__lastTouch=0,this.__preventProcessWidthAndHeight=!1,this.__preventProcessOffsetAndScale=!1,this.__$events.register(["ShapeChanged","ShapeConfirmed"])}__attach(){this.__$dom.registerEx(["SVG"],".TcHmi_Controls_Beckhoff_Vision_TcHmiVnShape-"),super.__attach(),this.__updateBoundary()}__registerOutsideHandleElement(t){0===t.length&&console.error("element not found (o)"),t?.css("position","absolute"),t?.css("width",18),t?.css("height",16),t?.css("will-change","transform"),t?.css("display","none"),t?.css("transition","transform 0.1 linear"),this.__outsideHandleElement=t}__registerHandleEventListeners(){this.__outsideHandleElement?.on("mousedown",(t=>{this.__touchCheck()&&this.__shapeDragHandler(t,!0)})),this.__outsideHandleElement?.on("touchstart",(t=>{this.__touchActive(),this.__shapeDragHandler(t,!0)}))}__positionFromEvent(e){const s=this.__$dom.SVG[0].getBoundingClientRect(),i=super.__positionFromEvent(e).minus(new t.Vector(s.x,s.y));return this.__rotationHandleDisplayPosition=i,i.times(1/this.__$props.Scale).minus(this.__offset).floor()}__touchActive(){this.__isTouching=!0,this.__lastTouch=(new Date).getTime(),this.__rotationHandleMouseOver=!1,this.__stopRotatingCursor()}__touchEnd(){this.__isTouching=!1,this.__lastTouch=(new Date).getTime()}__touchCheck(){return!this.__isTouching&&(new Date).getTime()-this.__lastTouch>400}__updateOutsideHandleUI(t){this.__isAttached&&(t&&-1!=this.__outsideHandle.position.x?(this.__outsideHandleElement.css("display","block"),this.__outsideHandleElement.css("cursor","pointer"),this.__outsideHandleElement?.css("transform",`translate(${this.__outsideHandle.position.x||0}px, ${this.__outsideHandle.position.y||0}px) rotate(${this.__outsideHandle.angle}rad)`)):this.__outsideHandleElement.css("display","none"))}__updateRotatingCursor(){"block"==this.__rotatingCursor?.css("display")&&this.__rotatingCursor?.css("transform",`translate(${this.__rotationHandleDisplayPosition.x-10}px, ${this.__rotationHandleDisplayPosition.y-10}px) rotate(${this.__lastMouseAngle}rad)`)}__setOutsideHandle(e){const s=new t.Vector(0,0),i=new t.Vector(this.__width??0,this.__height??0),n=e.plus(this.__offset).times(this.__$props.Scale);this.__outsideHandle.position.x=Math.max(s.x+20,Math.min(s.x+i.x-20,n.x))-9,this.__outsideHandle.position.y=Math.max(s.y+20,Math.min(s.y+i.y-20,n.y))-8;const o=s.x>n.x,r=s.y>n.y,_=s.x+i.x<n.x,a=s.y+i.y<n.y;this.__outsideHandle.angle=Math.PI*(o&&r?1.25:o&&a?.75:o?1:a&&_?.25:a?.5:_&&r?1.75:_?0:1.5)}__resetOutsideHandle(){this.__outsideHandle.position=new t.Vector(-1,-1)}__updateShapeDragBorders(t,e,s=!1){null!=this.__shapeBoundary&&this.__$props.Boundary.isActive?(this.__shapeDrag.borders[0]=this.__shapeBoundary.position.y+this.__shapeBoundary.size.y-Math.max(...t.map((t=>t.y)))+e.y-(s?.1:0),this.__shapeDrag.borders[1]=this.__shapeBoundary.position.x-Math.min(...t.map((t=>t.x)))+e.x+(s?.1:0),this.__shapeDrag.borders[2]=this.__shapeBoundary.position.y-Math.min(...t.map((t=>t.y)))+e.y+(s?.1:0),this.__shapeDrag.borders[3]=this.__shapeBoundary.position.x+this.__shapeBoundary.size.x-Math.max(...t.map((t=>t.x)))+e.x-(s?.1:0)):(this.__shapeDrag.borders[0]=1/0,this.__shapeDrag.borders[1]=-1/0,this.__shapeDrag.borders[2]=-1/0,this.__shapeDrag.borders[3]=1/0)}__updateAngleRestrictions(t,e,s){if(!this.__$props.Boundary.isActive)return void(this.__angleRestrictions=[]);let i=[];t.forEach((t=>{const n=t.minus(e),o=n.l2();this.__boundaryLines.forEach(((t,r)=>{const _=e.distanceToLine(t);if(_<o){const t=Math.acos(_/o),e=n.getAngle(),a=r*Math.PI/2,h=s;i.push([-e-t+a+h,-e+t+a+h])}}))})),i.map(((t,e)=>t.map(((t,s)=>i[e][s]=this.__fitAngle(t))))),i=i.map((t=>t.map((t=>Math.round(1e7*t)/1e7))));const n=(t,e,s)=>s!=e&&(t<e&&s>t&&s<e||t>e&&(s>t||s<e));let o=i,r=!0,_=!1;do{const t=o;o=[];const e=[];r=!0,t.forEach(((s,i)=>{t.forEach(((t,a)=>{_||i==a||e.includes(i)||e.includes(a)||(t[0]==s[0]||n(t[0],t[1],s[0]))&&(t[0]!=s[0]&&n(s[0],s[1],t[0])?_=!0:(o.push([t[0],s[0]<s[1]&&t[0]<t[1]||s[0]>s[1]&&t[0]>t[1]?Math.max(s[1],t[1]):s[0]<s[1]&&t[0]>t[1]?s[0]>=t[0]?t[1]:Math.max(s[1],t[1]):s[1]]),r=!1,e.push(i),e.push(a)))}))})),t.forEach(((t,s)=>{e.includes(s)||o.push([t[0],t[1]])}))}while(!r&&!_);this.__angleRestrictions=null==o?[]:o}__updateBoundary(){let e=this.__$props.Boundary.x,s=this.__$props.Boundary.y,i=this.__$props.Boundary.width,n=this.__$props.Boundary.height,o=(this.__width??0)*(1/this.__$props.Scale),r=(this.__height??0)*(1/this.__$props.Scale),_=-this.__$props.Offset[0],a=-this.__$props.Offset[1],h=o-this.__$props.Offset[0],p=r-this.__$props.Offset[1];i&&n||(i=o,n=r,e=_,s=a),this.__shapeBoundary.position.x=Math.min(Math.max(e,_),h),this.__shapeBoundary.position.y=Math.min(Math.max(s,a),p),this.__shapeBoundary.size.x=Math.min(i,o-(this.__shapeBoundary.position.x-_)),this.__shapeBoundary.size.y=Math.min(n,r-(this.__shapeBoundary.position.y-a));let l=this.__shapeBoundary.position,d=this.__shapeBoundary.position.plus(this.__shapeBoundary.size);this.__boundaryLines=[{start:d,direction:new t.Vector(1,0)},{start:l,direction:new t.Vector(0,1)},{start:l,direction:new t.Vector(1,0)},{start:d,direction:new t.Vector(0,1)}],this.__updateShapeIsInBoundary()}__isPointInBoundary(t){if(!this.__shapeBoundary)throw"__shapeBoundary not initialized";return t.x<=this.__shapeBoundary.position.x+this.__shapeBoundary.size.x&&t.x>=this.__shapeBoundary.position.x&&t.y<=this.__shapeBoundary.position.y+this.__shapeBoundary.size.y&&t.y>=this.__shapeBoundary.position.y}__isPointInControlArea(t){const e=t.plus(this.__offset);return e.x<=(this.__width??0)*(1/this.__$props.Scale)&&e.x>=0&&e.y<=(this.__height??0)*(1/this.__$props.Scale)&&e.y>=0}__shapeChanged(){this.__$events.ShapeChanged.raise()}__shapeConfirmed(){this.__$events.ShapeConfirmed.raise()}__transparentColor(t,e){return t.replace(/[0-9]+(\.[0-9]+)?\)/,e+")")}__fitAngle(t){for(;t<0;)t+=2*Math.PI;return t%(2*Math.PI)}__mapInterval(t,e,s){return(Math.floor((t-e-s/2)/s)+1)*s+e}__forceAngleInterval(t){const e=this.__minAngleDiff(t,this.__rotationDrag.lastMouseAngle);return this.__rotationDrag.runningAngle+=e.direction?-e.distance:e.distance,this.__rotationDrag.lastMouseAngle=t,this.__mapInterval(this.__rotationDrag.runningAngle,this.__rotationDrag.referenceAngle,this.__$props.AngleInterval*Math.PI/180)}__forceAngleIntoRestrictions(t){const e=(t,e,s)=>t<e&&s>t&&s<e||t>e&&(s>t||s<e);let s=t;if(this.__$props.Boundary.isActive)for(let i=0;i<this.__angleRestrictions.length;i++)if(e(this.__angleRestrictions[i][0],this.__angleRestrictions[i][1],t)){const e=this.__minAngleDiff(t,this.__angleRestrictions[i][0]).distance,n=this.__minAngleDiff(t,this.__angleRestrictions[i][1]).distance;s=this.__angleRestrictions[i][n<e?1:0]}return s}__minAngleDiff(t,e){const s=Math.abs(t-e),i=2*Math.PI-Math.max(t,e)+Math.min(t,e);return s<i?{distance:s,direction:t<e}:{distance:i,direction:e<t}}shapeDataIsValid(t=null){return!1}static roundShapeData(e){return Array.isArray(e)?t.TcHmiVnPolygon.roundShapeData(e):t.TcHmiVnRectangle.roundShapeData(e)}getStrokeColor(){return this.__$props.StrokeColor}setStrokeColor(t){null==t?this.__$setProperty("StrokeColor",{color:"rgba(0, 0, 0, 1)"}):this.__$setProperty("StrokeColor",t)}__processStrokeColor(){}getHandleColor(){return this.__$props.HandleColor}setHandleColor(t){null==t?this.__$setProperty("HandleColor",{color:"rgba(0, 0, 0, 1)"}):this.__$setProperty("HandleColor",t)}__processHandleColor(){}setWidth(t){super.setWidth(t)}__processWidth(){super.__processWidth(),this.__preventProcessWidthAndHeight||this.__processWidthAndHeightChangeInternal()}setHeight(t){super.setHeight(t)}__processHeight(){super.__processHeight(),this.__preventProcessWidthAndHeight||this.__processWidthAndHeightChangeInternal()}setWidthAndHeight(t,e){this.__preventProcessWidthAndHeight=!0;let s=!1;t!=this.__width&&(this.__$setProperty("Width",t),s=!0),e!=this.__height&&(this.__$setProperty("Height",e),s=!0),s&&this.__processWidthAndHeightChangeInternal()}__processWidthAndHeightChangeInternal(){this.__processWidthAndHeightChange(),this.__updateBoundary()}getRotationHandle(){return this.__$props.RotationHandle}setRotationHandle(t){this.__$setProperty("RotationHandle",t)}getBoundary(){return this.__$props.Boundary}setBoundary(t){this.__$setProperty("Boundary",t)}__processBoundary(){this.__updateBoundary()}getShapeIsInBoundary(){return this.__$props.ShapeIsInBoundary}__setShapeIsInBoundaryInternal(t){this.__$setPropertyInternal("ShapeIsInBoundary",t)}getDataUpdate(){return this.__$props.DataUpdate}setDataUpdate(t){this.__$setProperty("DataUpdate",t)}getStrokeThickness(){return this.__$props.StrokeThickness}setStrokeThickness(t){this.__$setProperty("StrokeThickness",t)}__processStrokeThickness(){}getStrokeThicknessUnit(){return"px"}setStrokeThicknessUnit(t){}getHandleSize(){return this.__$props.HandleSize}setHandleSize(t){this.__$setProperty("HandleSize",t)}__processHandleSize(){}getHandleSizeUnit(){return"px"}setHandleSizeUnit(t){}getClickableSize(){return this.__$props.ClickableSize}setClickableSize(t){this.__$setProperty("ClickableSize",t)}__processClickableSize(){}getClickableSizeUnit(){return"px"}setClickableSizeUnit(t){}getOffset(){return this.__$props.Offset}setOffset(t){this.__$setProperty("Offset",t)}__processOffset(){this.__offset=t.Vector.fromArray(this.__$props.Offset),this.__preventProcessOffsetAndScale||this.__processOffsetAndScaleChangeInternal()}getScale(){return this.__$props.Scale}setScale(t){this.__$setProperty("Scale",t)}__processScale(){this.__preventProcessOffsetAndScale||this.__processOffsetAndScaleChangeInternal()}setOffsetAndScale(t,e){this.__preventProcessOffsetAndScale=!0;let s=!1;2==t.length?t[0]==this.__$props.Offset[0]&&t[1]==this.__$props.Offset[1]||(this.__$setProperty("Offset",t),s=!0):(this.__$setProperty("Offset",[0,0]),s=!0),e!=this.__$props.Scale&&(this.__$setProperty("Scale",e),s=!0),s&&this.__processOffsetAndScaleChangeInternal(),this.__preventProcessOffsetAndScale=!1}__processOffsetAndScaleChangeInternal(){this.__processOffsetAndScaleChange(),this.__updateBoundary()}}t.TcHmiVnShape=e,function(e){class s extends t.TcHmiVnControl.Properties{constructor(){super(...arguments),this.StrokeColor={color:"rgba(0, 0, 0, 1)"},this.HandleColor={color:"rgba(0, 0, 0, 1)"},this.RotationHandle=!0,this.AngleInterval=0,this.Boundary={isActive:!1,x:0,y:0,width:0,height:0},this.ShapeIsInBoundary=!1,this.DataUpdate=t.DataUpdate.onChanged,this.StrokeThickness=4,this.HandleSize=5,this.ClickableSize=10,this.Offset=[0,0],this.Scale=1}}e.Properties=s;class i extends t.TcHmiVnControl.SubControls{}let n;e.SubControls=i,function(t){t[t.MouseEnd=0]="MouseEnd",t[t.MouseLeaveSVG=1]="MouseLeaveSVG"}(n=e.CallBackMethod||(e.CallBackMethod={}))}(e=t.TcHmiVnShape||(t.TcHmiVnShape={}))}(e=t.Vision||(t.Vision={}))}(e=t.Beckhoff||(t.Beckhoff={})),t.registerEx("TcHmiVnShape","TcHmi.Controls.Beckhoff.Vision",e.Vision.TcHmiVnShape)}(e=t.Controls||(t.Controls={}))}(TcHmi||(TcHmi={}));