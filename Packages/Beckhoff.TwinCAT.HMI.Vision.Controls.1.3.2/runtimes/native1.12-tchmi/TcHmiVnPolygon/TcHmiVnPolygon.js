var TcHmi;!function(t){let o;!function(t){let o;!function(t){let o;!function(t){class o extends t.TcHmiVnShape{constructor(s,i,_){super(s,i,_),this.__$props=new o.Properties,this.__$controls=new o.SubControls,this.__pointHandles=[],this.__domPolygon=null,this.__rotatingCursor=null,this.__rotationHandle=null,this.__polygon=new o.Polygon([]),this.__rotationHandlePosition=new t.Vector(0,0),this.__center=new t.Vector(0,0),this.__polygonIsCompleted=!1,this.__rotationHandleAngle=0,this.__activeDrag=o.ActiveDrag.None,this.__pointDrag={pointIndex:0,lastPosition:new t.Vector},this.__rotationDragPolygon={referencePolygon:[]},this.__lastMouseMovePosition=new t.Vector(0,0),this.__lastMouseAngle=0,this.__oldPolygon=null}__attach(){this.__registerHandleElements(),super.__attach(),this.__registerStaticListeners(),this.__updateUI(),this.__processClickableSize()}__registerStaticListeners(){super.__registerHandleEventListeners(),this.__$dom.SVG.bind("mousedown",(t=>{this.__touchCheck()&&this.__handleSurfaceMouseDown(t)})),this.__$dom.SVG.bind("touchstart",(t=>{this.__touchActive(),this.__handleSurfaceMouseDown(t)})),this.__$dom.SVG.bind("touchmove",(t=>{this.__touchActive(),this.__handleMouseMove(t)})),this.__$dom.SVG.bind("touchend",(t=>{this.__touchEnd(),this.__handleMouseUp(t)})),this.__$dom.SVG.bind("touchcancel",(t=>{this.__touchEnd(),this.__handleMouseUp(t)}));this.__rotationHandle.on("mousedown",(t=>{this.__touchCheck()&&this.__handleRotationMouseDown(t)})),this.__rotationHandle.on("touchstart",(t=>{this.__touchActive(),this.__handleRotationMouseDown(t)})),this.__rotationHandle.on("mouseenter",(t=>{this.__rotationHandleMouseOver=!0,this.__activeDrag==o.ActiveDrag.None&&(this.__registerGlobalEvents(),this.__polygonIsCompleted&&this.__touchCheck()&&(this.__rotatingCursor?.css("display","block"),this.__$dom.SVG.css("cursor","none")))})),this.__rotationHandle.on("mouseleave",(t=>{this.__rotationHandleMouseOver=!1,this.__activeDrag==o.ActiveDrag.None&&(this.__unregisterGlobalEvents(),this.__stopRotatingCursor())}))}__unregisterGlobalEvents(){this.__rotationHandleMouseOver||super.__unregisterGlobalEvents()}__registerHandleElements(){super.__registerOutsideHandleElement(this.__element.find(".TcHmi_Controls_Beckhoff_Vision_TcHmiVnShape-o")),this.__rotationHandle=this.__element.find(".TcHmi_Controls_Beckhoff_Vision_TcHmiVnShape-r"),0===this.__rotationHandle.length&&console.error("element not found (r)"),this.__rotationHandle.css("cursor","none"),this.__rotatingCursor=this.__element.find(".TcHmi_Controls_Beckhoff_Vision_TcHmiVnShape-m"),0===this.__rotatingCursor.length&&console.error("element not found (m)"),this.__rotatingCursor.css("position","absolute"),this.__rotatingCursor.css("height",20),this.__rotatingCursor.css("width",20),this.__rotatingCursor.css("will-change","transform"),this.__rotatingCursor.css("display","none"),this.__rotatingCursor.css("transition","transform 0.1 linear"),this.__rotatingCursor.css("pointer-events","none")}__handleSurfaceMouseDown(t){if(t.target===this.__$dom.SVG.get(0)&&!this.__polygonIsCompleted){const o=this.__positionFromEvent(t);if(this.__isPointInBoundary(o)){const s=this.__polygon.copy();this.__createPointAndHandle(o),this.__polygonIsCompleted&&(this.__updateShapeData(s),this.__shapeConfirmed()),this.__updateUI(),t.stopPropagation()}}}__shapeDragHandler(t,s=!1){this.__activeDrag=o.ActiveDrag.Shape,this.__oldPolygon=this.__polygon.copy(),this.__updateUI();const i=this.__positionFromEvent(t);this.__shapeDrag.lastPosition=s?this.__polygon.points[0].copy():i,this.__updateShapeDragBorders(this.__polygon.points,i),this.__registerGlobalEvents(),t.stopPropagation()}__circleDragHandler(t,s){this.__polygonIsCompleted||0!==this.__$props.NumPoints||0!==s?(this.__pointDrag.pointIndex=s,this.__pointDrag.lastPosition=this.__positionFromEvent(t),this.__activeDrag=o.ActiveDrag.Point,this.__oldPolygon=this.__polygon.copy(),this.__registerGlobalEvents()):(this.__polygonIsCompleted=!0,this.__updateShapeData(),this.__shapeConfirmed()),this.__updateUI(),t.stopPropagation()}__handleRotationMouseDown(t){this.__activeDrag=o.ActiveDrag.Rotation,this.__oldPolygon=this.__polygon.copy(),this.__updateUI(),this.__updateAngleRestrictions(this.__polygon.points,this.__center,this.__rotationHandleAngle),this.__rotationDrag.referenceAngle=this.__rotationHandleAngle,this.__rotationDragPolygon.referencePolygon=this.__polygon.points.map((t=>t.copy())),this.__registerGlobalEvents(),t.stopPropagation()}__handleMouseMove(s){const i=this.__positionFromEvent(s);switch(this.__lastMouseMovePosition=i,this.__activeDrag){case o.ActiveDrag.Point:{this.__$props.Boundary.isActive&&this.__polygonIsCompleted&&!this.__$props.ShapeIsInBoundary&&this.__moveShapeInside(i);const o=this.__pointDrag.pointIndex,s=this.__shapeBoundary,_=this.__polygon.copy();this.__$props.Boundary.isActive&&null!=s?(this.__polygon.points[o].x=Math.min(Math.max(i.x,s.position.x),s.position.x+s.size.x),this.__polygon.points[o].y=Math.min(Math.max(i.y,s.position.y),s.position.y+s.size.y)):this.__polygon.points[o]=i,this.__updateShapeData(_,!0,!0,this.__$props.DataUpdate==t.DataUpdate.onChanged),this.__pointDrag.lastPosition=this.__polygon.points[o].copy(),this.__updateUI();break}case o.ActiveDrag.Shape:{const o=i.copy();this.__$props.Boundary.isActive&&(o.x=Math.min(Math.max(i.x,this.__shapeDrag.borders[1]),this.__shapeDrag.borders[3]),o.y=Math.min(Math.max(i.y,this.__shapeDrag.borders[2]),this.__shapeDrag.borders[0]));const s=this.__polygon.copy();this.__dragPolygon(o.minus(this.__shapeDrag.lastPosition)),this.__updateShapeData(s,!0,!0,this.__$props.DataUpdate==t.DataUpdate.onChanged),this.__shapeDrag.lastPosition=o.copy(),this.__updateUI();break}}if(this.__activeDrag==o.ActiveDrag.Rotation||this.__rotationHandleMouseOver){let s=i.minus(this.__center).getAngle();if(this.__lastMouseAngle=s,this.__activeDrag==o.ActiveDrag.Rotation){this.__$props.Boundary.isActive&&!this.__$props.ShapeIsInBoundary&&(this.__moveShapeInside(i),s=i.minus(this.__center).getAngle(),this.__updateAngleRestrictions(this.__polygon.points,this.__center,s),this.__rotationDrag.referenceAngle=s,this.__rotationDragPolygon.referencePolygon=this.__polygon.points.map((t=>t.copy())));let o=s;0!==this.__$props.AngleInterval?o=this.__forceAngleInterval(s):this.__$props.Boundary.isActive&&(o=this.__forceAngleIntoRestrictions(s));const _=this.__polygon.copy(),e=o-this.__rotationDrag.referenceAngle;this.__polygon.points=this.__rotationDragPolygon.referencePolygon.map((t=>t.minus(this.__center).rotate2d(e).plus(this.__center))),this.__updateShapeData(_,!0,!1,this.__$props.DataUpdate==t.DataUpdate.onChanged),this.__rotationDrag.lastAngle=o,this.__updateUI()}this.__updateRotatingCursor()}this.__activeDrag!=o.ActiveDrag.None&&s.stopPropagation()}__dragPolygon(t){for(let o=0;o<this.__polygon.points.length;++o)null!=this.__polygon.points[o]&&(this.__polygon.points[o].x+=t.x,this.__polygon.points[o].y+=t.y)}__handleMouseLeave(t){this.__handleMouseUp(t)}__handleMouseUp(s){this.__stopRotatingCursor(),!this.__polygonIsCompleted||this.__activeDrag!=o.ActiveDrag.Rotation&&this.__activeDrag!=o.ActiveDrag.Point||this.__moveShapeInside(this.__positionFromEvent(s)),this.__$props.DataUpdate==t.DataUpdate.onConfirmed&&this.__updateShapeData(this.__oldPolygon);const i=this.__activeDrag==o.ActiveDrag.None;this.__activeDrag=o.ActiveDrag.None,this.__unregisterGlobalEvents(),this.__updateUI(),this.__polygonIsCompleted&&!i&&this.__shapeConfirmed(),s.stopPropagation()}__updateUI(){if(!this.__isAttached)return;this.__updateRotatingCursor();const s=this.__polygon.points.map((t=>t.plus(this.__offset).times(this.__$props.Scale)));if(0===s.length)this.__domPolygon?.css("display","none");else{null==this.__domPolygon&&(this.__domPolygon=t.CreateSVG("polyline").prependTo(this.__$dom.SVG),this.__domPolygon.css({fill:"none","stroke-linejoin":"round","stroke-linecap":"round"}),this.__domPolygon.on("mousedown",(t=>{this.__touchCheck()&&this.__shapeDragHandler(t)})),this.__domPolygon.on("touchstart",(t=>{this.__touchActive(),this.__shapeDragHandler(t)}))),this.__domPolygon?.css({"stroke-width":this.__activeDrag!=o.ActiveDrag.None?1:this.__$props.StrokeThickness.toString(),display:"block",stroke:this.__$props.StrokeColor.color});let i=s.map((t=>t?.toArray().join(","))).join(" ");this.__polygonIsCompleted&&this.__$props.Closed&&(i+=` ${s[0].x},${s[0].y}`),this.__domPolygon.attr("points",i)}for(;this.__pointHandles.length>s.length;)this.__pointHandles.pop().remove();if(s.forEach(((t,i)=>{null==this.__pointHandles[i]&&this.__createHandle(t,i),this.__pointHandles[i].attr("fill",this.__activeDrag!=o.ActiveDrag.None?this.__transparentColor(this.__$props.HandleColor.color,.2):this.__$props.HandleColor.color),this.__pointHandles[i].attr("cx",s[i].x),this.__pointHandles[i].attr("cy",s[i].y),this.__pointHandles[i].attr("r",this.__$props.HandleSize)})),this.__polygonIsCompleted&&this.__$props.RotationHandle){const i=s.reduce(((t,o)=>t.plus(o)),new t.Vector(0,0)).times(1/s.length),_=s.reduce(((t,o)=>Math.max(t,o.distanceTo(i))),0),e=s[0].minus(i),n=e.times((_+(2*this.__$props.HandleSize+this.__$props.ClickableSize))/e.l2());this.__rotationHandleAngle=n.getAngle(),this.__rotationHandlePosition=i.plus(n),this.__rotationHandle.attr("cx",this.__rotationHandlePosition.x),this.__rotationHandle.attr("cy",this.__rotationHandlePosition.y),this.__rotationHandle.attr("r",this.__$props.HandleSize),this.__rotationHandle.attr("stroke-width",this.__$props.ClickableSize),this.__rotationHandle.attr("fill",this.__activeDrag!=o.ActiveDrag.None?this.__transparentColor(this.__$props.HandleColor.color,.2):this.__$props.HandleColor.color),this.__rotationHandle.css("display","block")}else this.__rotationHandle.css("display","none");switch(this.__updateOutsideHandle(),this.__activeDrag){case o.ActiveDrag.None:this.__$dom.SVG.css("cursor",this.__polygonIsCompleted?"default":"crosshair"),this.__domPolygon?.css("cursor","move"),this.__rotationHandle?.css("cursor","none"),this.__pointHandles.forEach((t=>t.css("cursor","pointer")));break;case o.ActiveDrag.Point:this.__$dom.SVG.css("cursor","crosshair"),this.__domPolygon?.css("cursor","crosshair"),this.__rotationHandle?.css("cursor","crosshair"),this.__pointHandles.forEach((t=>t.css("cursor","crosshair")));break;case o.ActiveDrag.Shape:this.__$dom.SVG.css("cursor","move"),this.__domPolygon?.css("cursor","move"),this.__rotationHandle?.css("cursor","move"),this.__pointHandles.forEach((t=>t.css("cursor","move")));break;case o.ActiveDrag.Rotation:this.__$dom.SVG.css("cursor","none"),this.__domPolygon?.css("cursor","none"),this.__rotationHandle?.css("cursor","none"),this.__pointHandles.forEach((t=>t.css("cursor","none")))}}__updateOutsideHandle(){if(!this.__isAttached)return;let t=!1;this.__polygon.points.forEach((o=>t=t||this.__isPointInControlArea(o))),t=t||null!=this.__rotationHandlePosition&&this.__isPointInControlArea(this.__rotationHandlePosition),t||this.__$props.Boundary.isActive||!this.__polygonIsCompleted?this.__resetOutsideHandle():this.__setOutsideHandle(this.__polygon.points[0]),this.__updateOutsideHandleUI(this.__polygonIsCompleted)}__stopRotatingCursor(){this.__polygonIsCompleted&&!this.__rotationHandleMouseOver&&(this.__rotatingCursor?.css("display","none"),this.__$dom.SVG.css("cursor","default"))}__createPointAndHandle(t){this.__polygon.points.push(t.copy()),this.__$props.NumPoints&&this.__polygon.points.length>=this.__$props.NumPoints&&(this.__polygonIsCompleted=!0);const o=this.__polygon.points.length-1;this.__createHandle(t,o)}__createHandle(o,s){if(!this.__isAttached)return;const i=t.CreateSVG("circle").appendTo(this.__$dom.SVG);this.__pointHandles[s]=i,i.attr("cx",o.x),i.attr("cy",o.y),i.attr("r",this.__$props.HandleSize),i.attr("stroke","rgba(0, 0, 0, 0)"),i.attr("stroke-opacity","0"),i.attr("stroke-width",this.__$props.ClickableSize),i.css("display","block"),i.on("mousedown",(t=>{this.__touchCheck()&&this.__circleDragHandler(t,s)})),i.on("touchstart",(t=>{this.__touchActive(),this.__circleDragHandler(t,s)})),i.addClass("TcHmi_Controls_Beckhoff_Vision_TcHmiVnShape-Clutch")}__moveShapeInside(o){const s=this.__polygon.copy();this.__updateShapeDragBorders(this.__polygon.points,o);const i=new t.Vector(0,0);i.x=Math.max(Math.min(o.x,this.__shapeDrag.borders[3]),this.__shapeDrag.borders[1]),i.y=Math.max(Math.min(o.y,this.__shapeDrag.borders[0]),this.__shapeDrag.borders[2]),this.__dragPolygon(i.minus(o)),this.__updateShapeData(s,!0,!0,this.__$props.DataUpdate==t.DataUpdate.onChanged)}__updateCenter(){const o=this.__polygon.points.reduce(((t,o)=>t.plus(o)),new t.Vector(0,0)).times(1/this.__polygon.points.length);this.__center=o}__updateShapeData(t=null,o=!0,s=!0,i=!0){let _=null;if(this.__polygonIsCompleted?(this.__polygon.points=this.__polygon.points.map((t=>t.roundTo(3))),_=this.__polygon.points.map((t=>[t.x,t.y]))):o&&(_=[]),_){if(this.__$props.NumPoints>0){for(;_.length<this.__$props.NumPoints;)_.push([0,0]);for(;_.length>this.__$props.NumPoints;)_.splice(_.length-1,1)}s&&this.__updateCenter(),i&&(this.__setShapeDataInternal(_),(null==t||this.__polygon.differsTo(t))&&this.__polygonIsCompleted&&this.__shapeChanged())}}__updateShapeIsInBoundary(){let t=this.__polygonIsCompleted;this.__polygon.points.forEach((o=>t=t&&this.__isPointInBoundary(o))),this.__setShapeIsInBoundaryInternal(t)}__clearPolygon(){const t=this.__polygonIsCompleted;this.__polygon.points=[],this.__polygonIsCompleted=!1,this.__updateShapeIsInBoundary(),this.__updateShapeData(),this.__updateUI(),t&&this.__shapeChanged()}shapeDataIsValid(t=null){return o.polygonDataIsValid(t??this.__$props.ShapeData)}static polygonDataIsValid(t){return!!Array.isArray(t)&&(0!==t.length&&!t.reduce(((t,o)=>t&&0===o[0]&&0===o[1]),!0))}static roundShapeData(t){return t.map((t=>t.map((t=>Math.round(1e3*t)/1e3))))}__processHandleColor(){this.__isAttached&&this.__updateUI()}__processStrokeColor(){this.__isAttached&&this.__updateUI()}__processWidthAndHeightChange(){this.__isAttached&&this.__updateOutsideHandle()}getShapeData(){return this.__$props.ShapeData}setShapeData(t){this.__$setProperty("ShapeData",t.map((t=>t.map((t=>Math.round(1e3*t)/1e3)))))}__setShapeDataInternal(t){this.__$setPropertyInternal("ShapeData",t)}__processShapeData(o,s,i){if(this.shapeDataIsValid()){if(!i){const s=this.__polygon.copy();if(this.__polygonIsCompleted=!1,o.forEach(((o,s)=>{null==this.__pointHandles[s]&&this.__createPointAndHandle(t.Vector.fromArray(o))})),this.__polygon.points=o.map((o=>t.Vector.fromArray(o))),!i&&this.__polygon.points.length>0){(0===this.__$props.NumPoints||0!==this.__$props.NumPoints&&this.__polygon.points.length>=this.__$props.NumPoints)&&(this.__polygonIsCompleted=!0);let t=!1;for(;0!==this.__$props.NumPoints&&this.__polygon.points.length>this.__$props.NumPoints;)this.__polygon.points.splice(this.__polygon.points.length-1),this.__pointHandles[this.__pointHandles.length-1].remove(),this.__pointHandles.splice(this.__pointHandles.length-1),t=!0;t?this.__updateShapeData(s):this.__updateCenter()}}this.__updateBoundary(),this.__updateUI(),i||(this.__shapeChanged(),this.__polygonIsCompleted&&this.__shapeConfirmed())}else i||this.__clearPolygon()}getNumPoints(){return this.__$props.NumPoints}setNumPoints(t){this.__$setProperty("NumPoints",Math.max(t,0))}__processNumPoints(t){const o=this.__polygon.points.length!=t||!this.__polygonIsCompleted,s=this.__polygon.copy();this.__polygon.points.length>=t?0!=t&&(this.__polygonIsCompleted=!0,this.__polygon.points=this.__polygon.points.slice(0,t)):this.__polygonIsCompleted=!1,o&&0!=t&&(this.__updateShapeData(s,!1),this.__polygonIsCompleted&&this.__shapeConfirmed(),this.__updateUI())}getClosed(){return this.__$props.Closed}setClosed(t){this.__$setProperty("Closed",t)}__processClosed(){this.__updateUI()}clear(){this.__clearPolygon()}__processRotationHandle(){this.__isAttached&&this.__updateUI()}getAngleInterval(){return this.__$props.AngleInterval}setAngleInterval(t){this.__$setProperty("AngleInterval",t)}__processClickableSize(){if(!this.__isAttached)return;const t=this.__$props.ClickableSize;this.__rotationHandle?.attr("stroke-width",t),this.__pointHandles.forEach((o=>{o.attr("stroke-width",t)})),this.__updateUI()}__processStrokeThickness(){this.__isAttached&&this.__updateUI()}__processHandleSize(){this.__isAttached&&this.__updateUI()}__processOffsetAndScaleChange(){this.__isAttached&&this.__updateUI()}}t.TcHmiVnPolygon=o,function(o){class s extends t.TcHmiVnShape.Properties{constructor(){super(...arguments),this.ShapeData=[],this.NumPoints=0,this.Closed=!0}}o.Properties=s;class i extends t.TcHmiVnShape.SubControls{}o.SubControls=i;class _{constructor(t){this.points=t}copy(){return new _(this.points.map((t=>t.copy())))}differsTo(t){if(this.points.length!=t.points.length)return!0;{let o=!1;return this.points.forEach((s=>o=o||s.differsTo(t.points[this.points.indexOf(s)]))),o}}}let e;o.Polygon=_,function(t){t[t.None=0]="None",t[t.Point=1]="Point",t[t.Shape=2]="Shape",t[t.Rotation=3]="Rotation"}(e=o.ActiveDrag||(o.ActiveDrag={}))}(o=t.TcHmiVnPolygon||(t.TcHmiVnPolygon={}))}(o=t.Vision||(t.Vision={}))}(o=t.Beckhoff||(t.Beckhoff={})),t.registerEx("TcHmiVnPolygon","TcHmi.Controls.Beckhoff.Vision",o.Vision.TcHmiVnPolygon)}(o=t.Controls||(t.Controls={}))}(TcHmi||(TcHmi={}));