var __runInitializers=this&&this.__runInitializers||function(thisArg,initializers,value){for(var useValue=arguments.length>2,i=0;i<initializers.length;i++)value=useValue?initializers[i].call(thisArg,value):initializers[i].call(thisArg);return useValue?value:void 0},__esDecorate=this&&this.__esDecorate||function(ctor,descriptorIn,decorators,contextIn,initializers,extraInitializers){function accept(f){if(void 0!==f&&"function"!=typeof f)throw new TypeError("Function expected");return f}for(var _,kind=contextIn.kind,key="getter"===kind?"get":"setter"===kind?"set":"value",target=!descriptorIn&&ctor?contextIn.static?ctor:ctor.prototype:null,descriptor=descriptorIn||(target?Object.getOwnPropertyDescriptor(target,contextIn.name):{}),done=!1,i=decorators.length-1;i>=0;i--){var context={};for(var p in contextIn)context[p]="access"===p?{}:contextIn[p];for(var p in contextIn.access)context.access[p]=contextIn.access[p];context.addInitializer=function(f){if(done)throw new TypeError("Cannot add initializers after decoration has completed");extraInitializers.push(accept(f||null))};var result=(0,decorators[i])("accessor"===kind?{get:descriptor.get,set:descriptor.set}:descriptor[key],context);if("accessor"===kind){if(void 0===result)continue;if(null===result||"object"!=typeof result)throw new TypeError("Object expected");(_=accept(result.get))&&(descriptor.get=_),(_=accept(result.set))&&(descriptor.set=_),(_=accept(result.init))&&initializers.unshift(_)}else(_=accept(result))&&("field"===kind?initializers.unshift(_):descriptor[key]=_)}target&&Object.defineProperty(target,contextIn.name,descriptor),done=!0};const TcHmi=window.TcHmi;import{TcHmiControl}from"Beckhoff.TwinCAT.HMI.Framework/index.esm.js";let TcHmiPdfViewer=(()=>{let ___onIFrameLoaded_decorators,___onWebviewerloaded_decorators,_classSuper=TcHmiControl,_instanceExtraInitializers=[];return class extends _classSuper{static{const _metadata="function"==typeof Symbol&&Symbol.metadata?Object.create(_classSuper[Symbol.metadata]??null):void 0;___onIFrameLoaded_decorators=[TcHmi.EventHandler()],___onWebviewerloaded_decorators=[TcHmi.EventHandler()],__esDecorate(this,null,___onIFrameLoaded_decorators,{kind:"method",name:"__onIFrameLoaded",static:!1,private:!1,access:{has:obj=>"__onIFrameLoaded"in obj,get:obj=>obj.__onIFrameLoaded},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onWebviewerloaded_decorators,{kind:"method",name:"__onWebviewerloaded",static:!1,private:!1,access:{has:obj=>"__onWebviewerloaded"in obj,get:obj=>obj.__onWebviewerloaded},metadata:_metadata},null,_instanceExtraInitializers),_metadata&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:_metadata})}static#tchmiFQN="TcHmi.Controls.Beckhoff."+this.name;constructor(element,pcElement,attrs){super(element,pcElement,attrs),this.__viewerPath=tchmi_path(TcHmi.Environment.getControlBasePathEx(this)+"/../Lib/pdfjs/web/viewer.html")}__viewerPath=__runInitializers(this,_instanceExtraInitializers);__elementTemplateRoot;__elementIFrame;__file;__page;__namedDestination;__zoom;__pageMode;__allowFullscreen;__disallowFileOperations;__cursorTool;__previnit(){if(this.__elementTemplateRoot=this.__element.find(".TcHmi_Controls_Beckhoff_TcHmiPdfViewer-template"),this.__elementIFrame=this.__elementTemplateRoot.find(".TcHmi_Controls_Beckhoff_TcHmiPdfViewer-template-iframe"),0===this.__elementTemplateRoot.length||0===this.__elementIFrame.length)throw new Error("Invalid Template.html");super.__previnit()}__init(){super.__init(),this.__destroyOnDestroy.push(TcHmi.EventProvider.registerDomEvent(document,"webviewerloaded",this.__onWebviewerloaded),TcHmi.EventProvider.register("onLocaleChanged",(()=>this.__updatePdfLocale())),TcHmi.EventProvider.register("onThemeDataChanged",(()=>this.__updatePdfTheme())),TcHmi.EventProvider.registerDomEvent(this.__elementIFrame,"load",this.__onIFrameLoaded)),this.__processViewerUpdate()}__attach(){super.__attach()}__detach(){super.__detach()}destroy(){this.__keepAlive||super.destroy()}__onIFrameLoaded(_event){this.__processDisallowFileOperations(),this.__processCursorTool();const contentWindow=this.__elementIFrame[0].contentWindow;contentWindow?.PDFViewerApplication?.eventBus.on("pagechanging",(data=>{"number"==typeof data.pageNumber&&this.__page!==data.pageNumber&&(this.__page=data.pageNumber,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"Page"}))})),contentWindow?.PDFViewerApplication?.eventBus.on("documentloaded",(data=>{TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"PageCount"})}))}__onWebviewerloaded(event){if(!event.detail)return;const contentWindow=event.detail.source;this.__allowFullscreen||Object.defineProperty(contentWindow.document,"fullscreenEnabled",{value:!1,writable:!1}),contentWindow.PDFViewerApplicationOptions?.set("disablePreferences",!0),contentWindow.PDFViewerApplicationOptions?.set("locale",TcHmi.Locale.get()??"en");const darkMode=TcHmi.Theme.Resources.get(this,"DarkMode").value;contentWindow.PDFViewerApplicationOptions?.set("viewerCssTheme",darkMode?2:1)}__updatePdfLocale(){const contentWindow=this.__elementIFrame[0].contentWindow;contentWindow?.PDFViewerApplication?.initialized&&contentWindow.location.reload()}__updatePdfTheme(){const contentWindow=this.__elementIFrame[0].contentWindow;contentWindow?.PDFViewerApplication?.initialized&&contentWindow.location.reload()}getFileAbsolute(){if(TCHMI_DESIGNER)return"";if(!this.__file)return"";if(this.__file.startsWith("/Config/"))return TcHmi.Environment.getHostBaseUri()+this.__file;{let path="";return window.location.pathname&&(path=window.location.pathname.substring(0,window.location.pathname.lastIndexOf("/"))),window.location.protocol+"//"+window.location.host+"/"+tchmi_path(path+"/"+this.__file)}}__processViewerUpdate(){if(!this.__attributesInitialized)return;const fileUrl=this.getFileAbsolute(),hashArray=[];hashArray.push("zoom="+(this.__zoom??"auto")),hashArray.push("pagemode="+(this.__pageMode??"none")),!TCHMI_DESIGNER&&this.__namedDestination&&hashArray.push("nameddest="+this.__namedDestination),!TCHMI_DESIGNER&&this.__page&&hashArray.push("page="+this.__page);this.__elementIFrame[0].src=this.__viewerPath+"?file="+fileUrl+"#"+hashArray.join("&")}setFile(valueNew){let convertedValue=TcHmi.ValueConverter.toString(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("File")),convertedValue!==this.__file&&(this.__file=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"File"}),this.__processFile())}getFile(){return this.__file}__processFile(){const contentWindow=this.__elementIFrame[0].contentWindow;if(contentWindow?.PDFViewerApplication?.initialized){const newUrl=this.getFileAbsolute();newUrl?contentWindow.PDFViewerApplication.open({url:newUrl}).then((()=>{this.__processPage()})):contentWindow.PDFViewerApplication.close()}else this.__processViewerUpdate()}setPage(valueNew){let convertedValue=TcHmi.ValueConverter.toNumber(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("Page")),convertedValue!==this.__page&&(this.__page=null!==convertedValue?Math.floor(convertedValue):1,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"Page"}),this.__processPage())}getPage(){return this.__page}__processPage(){const contentWindow=this.__elementIFrame[0].contentWindow;if(contentWindow?.PDFViewerApplication?.initialized){const newPage=this.__page??1;contentWindow.PDFViewerApplication.pdfViewer.pageViewsReady?contentWindow.PDFViewerApplication.page!==newPage&&(contentWindow.PDFViewerApplication.page=newPage):contentWindow.PDFViewerApplication.pdfViewer.pagesPromise.then((()=>{contentWindow.PDFViewerApplication&&contentWindow.PDFViewerApplication.page!==newPage&&(contentWindow.PDFViewerApplication.page=newPage)}))}else this.__processViewerUpdate()}getPageCount(){const contentWindow=this.__elementIFrame[0].contentWindow;return contentWindow?.PDFViewerApplication?.pagesCount?contentWindow.PDFViewerApplication.pagesCount:null}setNamedDestination(valueNew){let convertedValue=TcHmi.ValueConverter.toString(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("NamedDestination")),convertedValue!==this.__namedDestination&&(this.__namedDestination=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"NamedDestination"}),this.__processNamedDestination())}getNamedDestination(){return this.__namedDestination}__processNamedDestination(){this.__processViewerUpdate()}setZoom(valueNew){let convertedValue=TcHmi.ValueConverter.toString(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("Zoom")),convertedValue!==this.__zoom&&(this.__zoom=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"Zoom"}),this.__processZoom())}getZoom(){return this.__zoom}__processZoom(){this.__processViewerUpdate()}setPageMode(valueNew){let convertedValue=TcHmi.ValueConverter.toString(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("PageMode")),convertedValue!==this.__pageMode&&(this.__pageMode="none"===convertedValue||"thumbs"===convertedValue||"bookmarks"===convertedValue||"attachments"===convertedValue?convertedValue:"none",TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"PageMode"}),this.__processPageMode())}getPageMode(){return this.__pageMode}__processPageMode(){this.__processViewerUpdate()}setAllowFullscreen(valueNew){let convertedValue=TcHmi.ValueConverter.toBoolean(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("AllowFullscreen")),convertedValue!==this.__allowFullscreen&&(this.__allowFullscreen=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"AllowFullscreen"}),this.__processAllowFullscreen())}getAllowFullscreen(){return this.__allowFullscreen}__processAllowFullscreen(){}setDisallowFileOperations(valueNew){let convertedValue=TcHmi.ValueConverter.toBoolean(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("DisallowFileOperations")),convertedValue!==this.__disallowFileOperations&&(this.__disallowFileOperations=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"DisallowFileOperations"}),this.__processDisallowFileOperations())}getDisallowFileOperations(){return this.__disallowFileOperations}__processDisallowFileOperations(){const contentWindow=this.__elementIFrame[0].contentWindow;if(!contentWindow)return;const fileOperationButtons=contentWindow.document.querySelectorAll(['[data-l10n-id="pdfjs-print-button"]','[data-l10n-id="pdfjs-open-file-button"]','[data-l10n-id="pdfjs-save-button"]','[data-l10n-id="pdfjs-editor-stamp-add-image-button"]'].join(","));TcHmi.StyleProvider.setSimpleElementStyle(fileOperationButtons,"display",this.__disallowFileOperations?"none":"")}setCursorTool(valueNew){let convertedValue=TcHmi.ValueConverter.toEnum(valueNew,CursorTool)??TcHmi.ValueConverter.toEnum(this.getAttributeDefaultValueInternal("CursorTool"),CursorTool,CursorTool.SELECT);convertedValue!==this.__cursorTool&&(this.__cursorTool=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"CursorTool"}),this.__processCursorTool())}getCursorTool(){return this.__cursorTool}__processCursorTool(){const contentWindow=this.__elementIFrame[0].contentWindow;contentWindow?.PDFViewerApplication?.initialized&&contentWindow.PDFViewerApplication.pdfCursorTools.switchTool(this.__cursorTool??CursorTool.SELECT)}}})();export{TcHmiPdfViewer};export var CursorTool;!function(CursorTool){CursorTool[CursorTool.SELECT=0]="SELECT",CursorTool[CursorTool.HAND=1]="HAND"}(CursorTool||(CursorTool={})),TcHmi.Controls.registerEx("TcHmiPdfViewer","TcHmi.Controls.Beckhoff",TcHmiPdfViewer,{injectInGlobalObject:!0});